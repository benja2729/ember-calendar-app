// ==========================================================================
// Project:   Ember Data
// Copyright: ©2011-2012 Tilde Inc. and contributors.
//            Portions ©2011 Living Social Inc. and contributors.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================



// Last commit: 49acd4b (2013-07-05 09:03:40 -0400)


!function(){function t(t,e){return t&&e&&t.x===e.x&&t.y===e.y}function e(){var e,n,r;Ember.instrument("view.updateContext.positionElement",this,function(){e=i(this,"element"),n=i(this,"position"),r=this._position,n&&e&&(t(n,r)||(this._parentView.applyTransform(e,n),this._position=n))},this)}var i=Ember.get;Ember.set,Ember.ListItemViewMixin=Ember.Mixin.create({init:function(){this._super(),this.one("didInsertElement",e)},classNames:["ember-list-item-view"],_position:null,_positionDidChange:Ember.observer(e,"position"),_positionElement:e})}(),function(){function t(t){t.willInsertElement&&t.willInsertElement()}function e(t){t.didInsertElement&&t.didInsertElement()}function i(){var i,s,l,h;i=n(this,"element"),i&&(l=n(this,"context"),this.triggerRecursively("willClearRender"),this.lengthAfterRender>this.lengthBeforeRender&&(this.clearRenderedChildren(),this._childViews.length=this.lengthBeforeRender),l?(s=Ember.RenderBuffer(),s=this.renderToBuffer(s),h=this._childViews.length>0,h&&this.invokeRecursively(t,!1),i.innerHTML=s.innerString?s.innerString():o(s),r(this,"element",i),this.transitionTo("inDOM"),h&&this.invokeRecursively(e,!1)):i.innerHTML="")}var n=Ember.get,r=Ember.set,o=function(t){var e=[],i=t.childBuffers;return Ember.ArrayPolyfills.forEach.call(i,function(t){var i="string"==typeof t;i?e.push(t):t.array(e)}),e.join("")};Ember.ListItemView=Ember.View.extend(Ember.ListItemViewMixin,{updateContext:function(t){var e=n(this,"context");Ember.instrument("view.updateContext.render",this,function(){e!==t&&(this.set("context",t),t instanceof Ember.ObjectController&&this.set("controller",t))},this)},rerender:function(){Ember.run.scheduleOnce("render",this,i)},_contextDidChange:Ember.observer(i,"context","controller")})}(),function(){var t=Ember.get,e=Ember.set;Ember.ReusableListItemView=Ember.View.extend(Ember.ListItemViewMixin,{init:function(){this._super(),this.set("context",Ember.ObjectProxy.create())},isVisible:Ember.computed("context.content",function(){return!!this.get("context.content")}),updateContext:function(i){var n=t(this,"context.content");n!==i&&("inDOM"===this.state&&this.prepareForReuse(i),e(this,"context.content",i))},prepareForReuse:Ember.K})}(),function(){Ember.ListViewHelper={applyTransform:function(){var t=document.createElement("div");return"webkitTransform"in t.style?function(t,e){var i=e.x,n=e.y;t.style.webkitTransform="translate3d("+i+"px, "+n+"px, 0)"}:function(t,e){var i=e.x,n=e.y;t.style.top=n+"px",t.style.left=i+"px"}}()}}(),function(){function t(){var t=h(this,"content");t&&t.addArrayObserver(this)}function e(t){this.removeObject(t),t.destroy()}function i(){Ember.run.once(this,"_syncChildViews")}function n(t,e){return h(t,"contentIndex")-h(e,"contentIndex")}function r(t){return Ember.ListItemViewMixin.detect(t)}function o(){Ember.View.notifyMutationListeners&&Ember.run.once(Ember.View,"notifyMutationListeners")}function s(){var t,e,i,n;t=h(this,"elementWidth"),e=h(this,"columnCount"),i=t*e,n=this.$(".ember-list-container"),i&&n&&n.css("width",i)}function l(){function t(t){console.time(t)}function e(t){console.timeEnd(t)}Ember.ENABLE_PROFILING&&(Ember.subscribe("view._scrollContentTo",{before:t,after:e}),Ember.subscribe("view.updateContext",{before:t,after:e}))}var h=Ember.get,c=Ember.set,u=Math.min,a=Math.max,m=Math.floor,d=Math.ceil,f=Ember.ArrayPolyfills.forEach,g=Ember.create(Ember.ContainerView.proto().domManager);g.prepend=function(t,e){t.$(".ember-list-container").prepend(e),o()},Ember.ListViewMixin=Ember.Mixin.create({itemViewClass:Ember.ListItemView,classNames:["ember-list-view"],attributeBindings:["style"],domManager:g,scrollTop:0,bottomPadding:0,_lastEndingIndex:0,paddingCount:1,init:function(){this._super(),l(),t.call(this),this._syncChildViews(),this.columnCountDidChange(),this.on("didInsertElement",s)},render:function(t){t.push('<div class="ember-list-container">'),this._super(t),t.push("</div>")},willInsertElement:function(){if(!this.get("height")||!this.get("rowHeight"))throw"A ListView must be created with a height and a rowHeight.";this._super()},style:Ember.computed("height","width",function(){var t,e,i,n;t=h(this,"height"),e=h(this,"width"),n=h(this,"css"),i="",t&&(i+="height:"+t+"px;"),e&&(i+="width:"+e+"px;");for(var r in n)n.hasOwnProperty(r)&&(i+=r+":"+n[r]+";");return i}),scrollTo:function(){throw"must override to perform the visual scroll and effectively delegate to _scrollContentTo"},_scrollTo:Ember.K,_scrollContentTo:function(t){var e,i,n,r,o,s;s=a(0,t),Ember.instrument("view._scrollContentTo",{scrollTop:s,content:h(this,"content"),startingIndex:this._startingIndex(),endingIndex:u(a(h(this,"content.length")-1,0),this._startingIndex()+this._numChildViewsForViewport())},function(){o=h(this,"content.length"),c(this,"scrollTop",s),r=a(o-1,0),e=this._startingIndex(),n=e+this._numChildViewsForViewport(),i=u(r,n),this.trigger("scrollYChanged",t),(e!==this._lastStartingIndex||i!==this._lastEndingIndex)&&(this._reuseChildren(),this._lastStartingIndex=e,this._lastEndingIndex=i)},this)},totalHeight:Ember.computed("content.length","rowHeight","columnCount","bottomPadding",function(){var t,e,i,n;return t=h(this,"content.length"),e=h(this,"rowHeight"),i=h(this,"columnCount"),n=h(this,"bottomPadding"),d(t/i)*e+n}),_prepareChildForReuse:function(t){t.prepareForReuse()},_reuseChildForContentIndex:function(t,e){var i,n,r,o;i=h(this,"content"),o=h(this,"enableProfiling"),r=this.positionForIndex(e),c(t,"position",r),c(t,"contentIndex",e),o&&Ember.instrument("view._reuseChildForContentIndex",r,function(){},this),n=i.objectAt(e),t.updateContext(n)},positionForIndex:function(t){var e,i,n,r,o,s;return e=h(this,"elementWidth")||1,i=h(this,"width")||1,n=h(this,"columnCount"),r=h(this,"rowHeight"),o=r*m(t/n),s=t%n*e,{y:o,x:s}},_childViewCount:function(){var t,e;return t=h(this,"content.length"),e=this._numChildViewsForViewport(),u(t,e)},columnCount:Ember.computed("width","elementWidth",function(){var t,e,i;return t=h(this,"elementWidth"),e=h(this,"width"),i=t?m(e/t):1}),columnCountDidChange:Ember.observer(function(){var t,e,i,n,r,o,l,a;o=this._lastColumnCount,e=h(this,"scrollTop"),l=h(this,"columnCount"),n=h(this,"maxScrollTop"),a=h(this,"element"),this._lastColumnCount=l,o&&(t=o/l,i=e*t,r=u(n,i),this._scrollTo(r),c(this,"scrollTop",r)),arguments.length>0&&Ember.run.schedule("afterRender",this,s)},"columnCount"),maxScrollTop:Ember.computed("height","totalHeight",function(){var t,e;return t=h(this,"totalHeight"),e=h(this,"height"),a(0,t-e)}),_numChildViewsForViewport:function(){var t,e,i,n;return t=h(this,"height"),e=h(this,"rowHeight"),i=h(this,"paddingCount"),n=h(this,"columnCount"),d(t/e)*n+i*n},_startingIndex:function(){var t,e,i,n,r,o;return r=h(this,"content.length"),t=h(this,"scrollTop"),e=h(this,"rowHeight"),i=h(this,"columnCount"),n=m(t/e)*i,o=a(r-1,0),u(n,o)},contentWillChange:Ember.beforeObserver(function(){var t;t=h(this,"content"),t&&t.removeArrayObserver(this)},"content"),contentDidChange:Ember.observer(function(){t.call(this),i.call(this)},"content"),needsSyncChildViews:Ember.observer(i,"height","width","columnCount"),_addItemView:function(){var t,e;t=h(this,"itemViewClass"),e=this.createChildView(t),this.pushObject(e)},_syncChildViews:function(){var t,i,n,r,o,s,l,c,u;if(!h(this,"isDestroyed")&&!h(this,"isDestroying")){if(i=this._childViewCount(),s=this.positionOrderedChildViews(),t=this._startingIndex(),n=t+i,o=i,r=s.length,c=o-r,0===c);else if(c>0)for(u=this._lastEndingIndex,l=0;c>l;l++,u++)this._addItemView(u);else f.call(s.splice(o,r),e,this);this._scrollContentTo(h(this,"scrollTop")),this._reuseChildren(),this._lastStartingIndex=t,this._lastEndingIndex=this._lastEndingIndex+c}},_reuseChildren:function(){var t,e,i,n,r,o,s,l,c,m,d;for(d=h(this,"scrollTop"),t=h(this,"content.length"),c=a(t-1,0),e=h(this,"listItemViews"),i=e.length,n=this._startingIndex(),l=n+this._numChildViewsForViewport(),r=u(c,l),this.trigger("scrollContentTo",d),m=u(l,n+i),s=n;m>s;s++)o=e[s%i],this._reuseChildForContentIndex(o,s)},listItemViews:Ember.computed("[]",function(){return this.filter(r)}),positionOrderedChildViews:function(){return h(this,"listItemViews").sort(n)},arrayWillChange:Ember.K,arrayDidChange:function(t,e){var n,r;"inDOM"===this.state&&((e>=this._lastStartingIndex||e<this._lastEndingIndex)&&(n=0,f.call(this.positionOrderedChildViews(),function(t){r=this._lastStartingIndex+n,this._reuseChildForContentIndex(t,r),n++},this)),i.call(this))}})}(),function(){var t=Ember.get;Ember.set,Ember.ListView=Ember.ContainerView.extend(Ember.ListViewMixin,{css:{position:"relative",overflow:"scroll","-webkit-overflow-scrolling":"touch","overflow-scrolling":"touch"},applyTransform:function(t,e){var i=e.x,n=e.y;t.style.top=n+"px",t.style.left=i+"px"},_scrollTo:function(e){var i=t(this,"element");i&&(i.scrollTop=e)},didInsertElement:function(){var e,i;e=this,i=t(this,"element"),this._updateScrollableHeight(),this._scroll=function(t){e.scroll(t)},Ember.$(i).on("scroll",this._scroll)},willDestroyElement:function(){var e;e=t(this,"element"),Ember.$(e).off("scroll",this._scroll)},scroll:function(t){Ember.run(this,this.scrollTo,t.target.scrollTop)},scrollTo:function(e){t(this,"element"),this._scrollTo(e),this._scrollContentTo(e)},totalHeightDidChange:Ember.observer(function(){Ember.run.scheduleOnce("afterRender",this,this._updateScrollableHeight)},"totalHeight"),_updateScrollableHeight:function(){"inDOM"===this.state&&this.$(".ember-list-container").css({height:t(this,"totalHeight")})}})}(),function(){function t(t){var i,n,r;t=t||this,i=e(t,"width"),n=e(t,"height"),r=e(t,"totalHeight"),t.scroller.setDimensions(i,n,i,r),t.trigger("scrollerDimensionsDidChange")}var e=(Math.max,Ember.get);Ember.set,Ember.VirtualListView=Ember.ContainerView.extend(Ember.ListViewMixin,{_isScrolling:!1,css:{position:"relative",overflow:"hidden"},init:function(){this._super(),this.setupScroller()},_scrollerTop:0,applyTransform:Ember.ListViewHelper.applyTransform,setupScroller:function(){var e;e=this,e.scroller=new Scroller(function(t,i){"inDOM"===e.state&&e.listContainerElement&&(e.applyTransform(e.listContainerElement,{x:0,y:-i}),e._scrollerTop=i,e._scrollContentTo(i))},{scrollingX:!1,scrollingComplete:function(){e.trigger("scrollingDidComplete")}}),e.trigger("didInitializeScroller"),t(e)},scrollerDimensionsNeedToChange:Ember.observer(function(){Ember.run.once(this,t)},"width","height","totalHeight"),didInsertElement:function(){var t;t=this,this.listContainerElement=this.$("> .ember-list-container")[0],this._mouseWheel=function(e){t.mouseWheel(e)},this.$().on("mousewheel",this._mouseWheel)},willDestroyElement:function(){this.$().off("mousewheel",this._mouseWheel)},willBeginScroll:function(t,e){this._isScrolling=!1,this.trigger("scrollingDidStart"),this.scroller.doTouchStart(t,e)},continueScroll:function(t,e){var i,n,r;this._isScrolling?this.scroller.doTouchMove(t,e):(i=this._scrollerTop,this.scroller.doTouchMove(t,e),n=this._scrollerTop,i!==n&&(r=Ember.$.Event("scrollerstart"),Ember.$(t[0].target).trigger(r),this._isScrolling=!0))},scrollTo:function(t,e){void 0===e&&(e=!0),this.scroller.scrollTo(0,t,e,1)},mouseWheel:function(t){var e,i,n;return e=t.webkitDirectionInvertedFromDevice,i=t.wheelDeltaY*(e?.8:-.8),n=this.scroller.__scrollTop+i,n>=0&&n<=this.scroller.__maxScrollTop&&this.scroller.scrollBy(0,i,!0),!1},endScroll:function(t){this.scroller.doTouchEnd(t)},touchStart:function(t){return t=t.originalEvent||t,this.willBeginScroll(t.touches,t.timeStamp),!1},touchMove:function(t){return t=t.originalEvent||t,this.continueScroll(t.touches,t.timeStamp),!1},touchEnd:function(t){return t=t.originalEvent||t,this.endScroll(t.timeStamp),!1},mouseDown:function(t){return this.willBeginScroll([t],t.timeStamp),!1},mouseMove:function(t){return this.continueScroll([t],t.timeStamp),!1},mouseUp:function(t){return this.endScroll(t.timeStamp),!1},mouseLeave:function(t){return this.endScroll(t.timeStamp),!1}})}(),"undefined"==typeof location||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||Ember.Logger.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. If you want full error messages please use the non-minified build provided on the Ember website.");